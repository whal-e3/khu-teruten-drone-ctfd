from pwn import *

encrypted_packet = b'\xef\x93pY\x9b\xa4q\xca\x12\xa58\rV\xde\x16h~\xc9/4!\xfa\x07h%\xcd/5"\xd3C\x06#\xfaF,!\x90E\x06%\xcdC\x06~\xd0\x06\x06p\x91Gn!\xd7\t\x06#\x90/=!\x91\x14$\x0b\xe1'

xor_key = [0] * 4

# 1. magic (0xFD)
xor_key[0] = encrypted_packet[0] ^ 0xFD

# 2. msgid (0x000093, BATTERY_STATUS)
xor_key[7 % 4] = encrypted_packet[7] ^ 0x93
xor_key[8 % 4] = encrypted_packet[8]       
xor_key[9 % 4] = encrypted_packet[9]      

for rand in range(0x100):
    xor_key[2] = rand
    decrytped_packet = xor(xor_key, encrypted_packet)
    if b'HTD' in decrytped_packet:
        print(xor_key)
        print(f"bruteforce {hex(rand)} : {decrytped_packet[10:]}")